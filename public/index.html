<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <link rel="icon" href="%PUBLIC_URL%/favicon.ico" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta name="theme-color" content="#000000" />
    <meta
      name="description"
      content="Web site created using create-react-app"
    />
    <meta name="isHybrid" content="false"/>
    <link rel="apple-touch-icon" href="%PUBLIC_URL%/logo192.png" />
    <link rel="manifest" href="%PUBLIC_URL%/manifest.json" />
    <title>React App</title>
    <script></script>
  <script type="text/javascript" src="%PUBLIC_URL%/2.52.0.js" async onload='initializeClient()'></script>
  <script>
    function initializeClient() {
      let pollingIntervalId;
      let reminderTimeoutId;

      /**
       * Starts the bcClient with the given CSID, if valid.
       */
      function startClient(csid) {

        let csid_internal = csid.trim();
      
        if (
          window.bcClientConfiguration &&
          typeof bcClient?.start === 'function' && csid_internal
        ) {
          bcClient.start(
            'https://wup-bladetest.au.v2.customers.biocatch.com',
            'bladetest',
            csid_internal,
            window.bcClientConfiguration,
            4
          );
          console.log('bcClient started with CSID:', csid_internal); // remember to delete this line in production
            console.log("from file cdApiAndBcClient.js not");
        } else {
             console.log("from file cdApiAndBcClient.js not");
          console.error(
            'bcClientConfiguration or bcClient.start not available'
            
          ); // remember to delete this line in production
        }
            cdApi.changeContext('Payment_WebView');
   
      }

      /**
       * Check the document for a valid CSID in meta tag.
       * Starts the client if found and clears all timers.
       */
      function checkForCSID() {
        console.log('Checking for meta tag...'); // remember to delete this line in production
        const getMetatagContent = window.bcGetMetatagContent;

        if (typeof getMetatagContent !== 'function') {
          console.error('bcGetMetatagContent is not defined.'); // remember to delete this line in production
          return;
        }

        const csid = getMetatagContent('customerSessionId');

        if (csid && csid.length > 10) {
          console.log('Valid meta tag found. Initializing client...'); // remember to delete this line in production
          startClient(csid);
          clearInterval(pollingIntervalId);
          clearTimeout(reminderTimeoutId);
        }
      }

      /**
       * Stops all polling and timeouts.
       */
      function stopPolling() {
        clearInterval(pollingIntervalId);
        clearTimeout(reminderTimeoutId);
        console.log('Polling stopped after timeout.'); // remember to delete this line in production
      }

      // Begin polling every 1 seconds
      pollingIntervalId = setInterval(checkForCSID, 1000);

      // Stop all activity after 10 seconds
      reminderTimeoutId = setTimeout(() => {
        console.warn(
          'CSID meta tag not found within 10 seconds. Stopping polling.'
        ); // remember to delete this line in production
        stopPolling();
      }, 10000);
    }
  </script>

</head>
  <body>
    <div id="root"></div>
  </body>
</html>
